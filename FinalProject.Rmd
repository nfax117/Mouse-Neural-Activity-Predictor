---
title: "STA 141A Final Project: Predictive Model of Mice Neural Activity"
author: "Nathaniel Faxon 917100572"
date: "2023-04-18"
output: html_document
abstract: |
  Put the abstract here
---

1st Task: Understanding Data

1)  Abstract -\> What you did in the project (3-4 sentences)

## Introduction

2)  Introduction

-   Questions of interest along with real-world motivation

    -   In the original study, the neural activity of 30,000 neurons in 42 brain regions of mice were analyzed. There were 10 mice analyzed over 39 different sessions. Within each session, visual stimuli were presented to the mice at random, then the reaction of the mice to this stimuli were recorded.
    -   In this project, we will be analyzing the different trials and recorded neuron spikes in order to make a predictive model.

-   Impact of results

-   Basic information of data (source, key variables, hypotheses), method, and why.

    -   The data comes from 18 different session of 4 different mice brain neural activity. The four mice that we are studying the neural responses of are Cori, Forssmann, Hench, and Lederberg. More specifically, the first three sessions analyzed Cori, the next four Forssmann, the next four Hench, and the last seven Lederberg. These sessions were taken between 12/14/2016 through 12/11/2017.

    -   Within each session, there were many trials where the activity of the neurons in the mice's visual cortex was recorded based on their decision making when faced with visual stimuli. Their decision making consists of turning the wheel either to the left or right or holding it still. Different variables were recorded for the 4 different mice. 8 variables are recorded each session:

        -   brain_area: The area of the brain where each neuron lives.
        -   contrast_left: Contrast on the left stimulus. Can take values 0, 0.25, 0.5, 1 (0 indicating the absence of a stimulus).
        -   contrast_right: Contrast on the right stimulus. Can take values 0, 0.25, 0.5, 1 (0 indicating the absence of a stimulus).
        -   date_exp: Date of the experiment on the mouse.
        -   feedback_type: The type of feedback that was administered base on the outcome of the mouse's decision. There are four different cases that can happen:
            -   When the right contrast is greater than the left contrast: If the mouse turned the wheel to the left, feedback_type = 1. If turned to the right, feedback_type = -1.
            -   When the left contrast is greater than the right contrast: If the mouse turned the wheel to the right, feedback_type = 1. If turned to the left, feedback_type = -1.
            -   When the left contrast and right contrast equal 0: If mouse held the wheel still, feedback_type = 1. Otherwise, feedback_type = -1.
            -   When the left contrast and right contrast are equal and not both 0: There is a 50% chance that feedback_type = 1 or -1.
        -   mouse_name: Name of the mouse being used in the experiment (trial). Specific to this project, the 4 mice are Cori, Forssmann, Hench, and Lederberg.
        -   spks: Numbers of spikes of neurons in the visual cortex. Holds many different trials.
        -   time: Center of the time bins for the spks.

-   Existing research and known results

## Exploratory Analysis

3)  Exploratory Analysis

-   Basic descriptive statistics (missing, mean, quartiles, \# of observations)
-   Data visualization (features, patterns in data)

## Methodology

4)  Methodology:

-   Data Integration: PCA, clustering (improving prediction performance)
-   Predictive Model (GLM, linear regression, time series)

### Data Integration

### Predictive Modeling

5)  Result (prediction performance)

6)  Conclusion, Discussion

-   Findings, variable information, drawbacks/disadvantages, next steps

7)  References


```{r}
suppressWarnings(library(tidyverse))
suppressWarnings(library(ggplot2))
suppressWarnings(library(knitr))
suppressWarnings(library(dplyr))
suppressWarnings(library(gtools))
suppressWarnings(library(corrplot))
suppressWarnings(library(gridExtra))
suppressWarnings(library(grid))
suppressWarnings(library(PerformanceAnalytics))
suppressWarnings(library(grDevices))
suppressWarnings(library(viridis))
suppressWarnings(library(RColorBrewer))
suppressWarnings(library(reshape2))
suppressWarnings(library(ggcorrplot))
suppressWarnings(library(DT))
```

```{r}

session=list()
for(i in 1:18){
  session[[i]]=readRDS(paste('./Data/session',i,'.rds',sep=''))
  #print(session[[i]]$mouse_name)
  #print(session[[i]]$date_exp)
  
}

```

## Understanding the DataSet

# Information of each session

```{r}

# Get the variables recorded within this session
print(ls(session[[1]])) # or names(session[[1]]))

#Determine the different variables and details within each session

uniqueBrainareasVector <- c()

for (i in 1:18) {
  
  message("Session ", i)
  
  session_i <- session[[i]]
  
  print(session[[i]]$mouse_name)
  print(session[[i]]$date_exp)
  
  # Get the affected brain areas within this session
  print("Affected brain areas:")
  print(unique(session_i$brain_area))
  
  uniqueBrainareasVector <- append(uniqueBrainareasVector, unique(session_i$brain_area))
  
  # Get the number of trials within the session
  print("Number of trials:")
  print(length(session_i$feedback_type))
  
}

# Get the unique brainareas through all sessions
uniqueBrainareasVector <- unique(uniqueBrainareasVector)
uniqueBrainareasVectorLength = length(uniqueBrainareasVector)
message("There are ", uniqueBrainareasVectorLength, " unique brain areas throughout all sessions:")
print(uniqueBrainareasVector)



```

# Parse Into Dataframe

```{r}
# Dataframe for the average spks per trial for each session

# Function to calculate the average spks per brain area for the specific trial of a session
firing_rate_brainarea <- function(trialNum, currSession) {
  
  spkTrial = currSession$spks[[trialNum]]
  currBrainArea = currSession$brain_area
  spkCount = apply(spkTrial, 1, sum)
  spkAvg = tapply(spkCount, currBrainArea, mean)
  return(spkAvg)
  
}


# Function to find average spks per brain area for all trials in a session
trial_firing_rate_brainarea <- function(sessionNum) {
  
  trialLen = length(session[[sessionNum]]$feedback_type)
  brainareaLen = length(unique(session[[sessionNum]]$brain_area))
  
  trialBrainareaSummary = matrix(nrow = trialLen, ncol = brainareaLen + 2)
  
  for(q in 1:trialLen) {
    
    trialBrainareaSummary[q,] = c(firing_rate_brainarea(q, currSession = session[[sessionNum]]), sessionNum, q)
    
  }
  
  colnames(trialBrainareaSummary) = c(names(firing_rate_brainarea(q,currSession = session[[sessionNum]])), 'session_number', 'trial_number')
  
  trialBrainareaSummary <- as_tibble(trialBrainareaSummary)
  
  
  # Plot the spikes per area in each session against trials
  colorPalette = brewer.pal(n=brainareaLen, name = 'Paired')

  plot(0~1, col='white',xlim=c(0,trialLen),ylim=c(0.5,2.2), xlab="Trials",ylab="Average Spike Counts", main=paste("Spikes per Area in Session", sessionNum))
  
  for(i in 1:brainareaLen){
    lines(y=trialBrainareaSummary[[i]],x=trialBrainareaSummary$trial_number,col=colorPalette[i],lty=2,lwd=1)
    lines(smooth.spline(trialBrainareaSummary$trial_number, trialBrainareaSummary[[i]]),col=colorPalette[i],lwd=3)
  }
  
  legend("topright", 
         legend = colnames(trialBrainareaSummary)[1:brainareaLen], 
         col = colorPalette, 
         lty = 1, 
         cex = 0.8
  )
    
    
    # Plot the correlation matrix for the brain areas, see if there are relations between brain areas
    correlationMatrixPlot <- suppressWarnings(chart.Correlation(trialBrainareaSummary[, 3:brainareaLen], histogram = TRUE, pch = 7, alpha = 0.3))
    correlationMatrixPlot
    
  
  # Return the dataframe of brain areas for one session
  return(trialBrainareaSummary)
  
}

# Use above function to apply to all sessions, bind them together to make one dataframe of all session brainarea spk averages. 

brainarea_firing_rateDF <- data.frame()

for (p in 1:18) {
  
  brainarea_firing_rateDF = bind_rows(brainarea_firing_rateDF, trial_firing_rate_brainarea(p))

}

brainarea_firing_rateDF <- relocate(brainarea_firing_rateDF, trial_number)
brainarea_firing_rateDF <- relocate(brainarea_firing_rateDF, session_number)

#head(brainarea_firing_rateDF)
#datatable(brainarea_firing_rateDF)

# In the correlation matrices:
#The distribution of each variable is shown on the diagonal.
#On the bottom of the diagonal : the bivariate scatter plots with a fitted line are displayed
#On the top of the diagonal : the value of the correlation plus the significance level as stars
#Each significance level is associated to a symbol : p-values(0, 0.001, 0.01, 0.05, 0.1, 1) <=> symbols(“***”, “**”, “*”, “.”, " “)

```

```{r}
# Dataframe with general statistics across sessions

sessionDF <- data.frame()

for (i in 1:18) {

  #Create a custom dataframe here with 4 columns for 4 variables
  trialDF <- data.frame(matrix(ncol = 5, nrow = 0))

  for (j in 1:length(session[[i]]$spks)) { 
    
    # Calculate the total number of neurons active
    neuronCountTable = table(unlist(session[[i]]$spks[[j]]))
    neuronCountValues = as.numeric(neuronCountTable)
    numActiveNeurons = length(session[[i]]$spks[[j]]) - neuronCountValues[1] #neuronCountValues[1] is the # of 0's
    
    # Calculate the total number of spks
    numSpks = 0
    for(k in 1:length(neuronCountTable)) {
    
      numSpks = numSpks + ((k-1) * neuronCountValues[k])
      
    }
    
    # Calculate the proportion of active neurons
    activeNeuronProp = numActiveNeurons / length(session[[i]]$spks[[i]])
    
    # Calculate the firing rate (total number of spks != 0 divided by total)
    firing_rate = numSpks / (numSpks + neuronCountValues[1])
    
    # Calculate the absolute difference between left and right contrast
    contrastDifference = abs(session[[i]]$contrast_left[j] - session[[i]]$contrast_right[j])
    
    # Append to the variables to the trial data frame
    trialDF[nrow(trialDF) + 1,] = c(contrastDifference, numActiveNeurons, numSpks, activeNeuronProp, firing_rate)
    
  }
  

  # Append data together using cbind
  tempSession = cbind(rep(i,length(session[[i]]$contrast_left)),
                       seq(1, length(session[[i]]$spks)),
                       session[[i]]$mouse_name, 
                       session[[i]]$contrast_left,
                       session[[i]]$contrast_right,
                       length(session[[i]]$brain_area),
                       length(unique(session[[i]]$brain_area)),
                       length(session[[i]]$spks),
                       trialDF,
                       session[[i]]$feedback_type
                       )
  
  # Append each session using rbind
  if (i == 1){
    sessionDF <- tempSession
  }
  else {
    sessionDF = rbind(sessionDF, tempSession)
  }
  
  
}


colnames(sessionDF) = c("session_number", "trial_number", "mouse_name", "contrast_left", "contrast_right", "total_number_of_neurons", "number_of_unique_brain_area", "number_of_trials", "contrast_difference", "number_of_active_neurons", "total_number_of_spks", "proportion_of_active_neurons", "firing_rate", "feedback_type")
sessionDF = as.data.frame(sessionDF)
sessionDF$session_number = as.factor(sessionDF$session_number)

#head(sessionDF)
#datatable(sessionDF)

```

# Plots

```{r}

# Box plots of firing rate (or numberofactiveneurons, total num of spikes, or proportion) on feedbacktype
# Mention how spks and active neurons are different, since there can be multiple spks per neuron


# Box Plots


# Firing Rate on Feedback Type
firingRate_by_feedback_boxPlot <- ggplot(sessionDF, aes(x = as.factor(feedback_type), y = firing_rate)) + geom_boxplot(outlier.color="red", outlier.shape=8, outlier.size=2, alpha = 0.2) + xlab("Feedback Type") + ylab("Firing Rate") + ggtitle("Box Plot of Firing Rate on Feedback Type") + theme(legend.position="none")

# Number of Active Neurons on Feedback Type
numActiveNeurons_by_feedback_boxPlot <- ggplot(sessionDF, aes(x = as.factor(feedback_type), y = number_of_active_neurons)) + geom_boxplot(outlier.color="red", outlier.shape=8, outlier.size=2, alpha = 0.2) + xlab("Feedback Type") + ylab("Number of Active Neurons") + ggtitle("Box Plot of Number of Active Neurons on Feedback Type") + theme(legend.position="none")

# Total Number of Spikes on Feedback Type
totalNumSpikes_by_feedback_boxPlot <- ggplot(sessionDF, aes(x = as.factor(feedback_type), y = total_number_of_spks)) + geom_boxplot(outlier.color="red", outlier.shape=8, outlier.size=2, alpha = 0.2) + xlab("Feedback Type") + ylab("Total Number of Spikes") + ggtitle("Box Plot of Total Number of Spikes on Feedback Type") + theme(legend.position="none")

# Proportion of Active Neurons on Feedback Type
proportionActiveNeurons_by_feedback_boxPlot <- ggplot(sessionDF, aes(x = as.factor(feedback_type), y = proportion_of_active_neurons)) + geom_boxplot(outlier.color="red", outlier.shape=8, outlier.size=2, alpha = 0.2) + xlab("Feedback Type") + ylab("Proportion of Active Neurons") + ggtitle("Box Plot of Proportion of Active Neurons on Feedback Type") + theme(legend.position="none")


grid.arrange(firingRate_by_feedback_boxPlot, proportionActiveNeurons_by_feedback_boxPlot, numActiveNeurons_by_feedback_boxPlot, totalNumSpikes_by_feedback_boxPlot, nrow = 2, ncol = 2)


```

```{r}

# Correlation Matrices for each Session
for (i in 1:18) {
  
  corrplot.mixed(round(cor(sessionDF[sessionDF$session_number == i, c('contrast_left', 'contrast_right', 'contrast_difference', 'number_of_active_neurons', 'total_number_of_spks', 'proportion_of_active_neurons', 'firing_rate', 'feedback_type')]), 2), title = paste("Correlation Matrix of Session", i), mar=c(1,1,1,1))
  
}
```


```{r}

# Correlation Matrices for Each Mouse
mouseNameVector <- c('Cori', 'Forssmann', 'Hench', 'Lederberg')
for (i in 1:length(mouseNameVector)) {
  
  corrplot.mixed(round(cor(sessionDF[sessionDF$mouse_name == mouseNameVector[i], c('contrast_left', 'contrast_right', 'number_of_active_neurons', 'total_number_of_spks', 'proportion_of_active_neurons', 'firing_rate', 'feedback_type')]), 2), title = paste("Correlation Matrix of Mouse", mouseNameVector[i]), mar=c(1,1,1,1))
  
}

```


```{r}

# Plots for variables against trials (for individual session analysis)

for (i in 1:18) {
 
  plot1 <- ggplot(sessionDF[sessionDF$session_number == i,], aes(x = trial_number, y = number_of_active_neurons)) + geom_point() + geom_smooth(formula = y ~ x, method="lm") + ggtitle("Number of Active Neurons Against Trials") + labs(y = "Number of Active Neurons", x = "Trials")
  
  plot2 <- ggplot(sessionDF[sessionDF$session_number == i,], aes(x = trial_number, y = total_number_of_spks)) + geom_point() + geom_smooth(formula = y ~ x, method="lm") + ggtitle("Total Number of Spikes Against Trials") + labs(y = "Total Number of Spikes", x = "Trials")
  
  plot3 <- ggplot(sessionDF[sessionDF$session_number == i,], aes(x = trial_number, y = proportion_of_active_neurons)) + geom_point() + geom_smooth(formula = y ~ x, method="lm") + ggtitle("Proportion of Active Neurons Against Trials") + labs(y = "Proportion of Active Neurons", x = "Trials")
  
  plot4 <- ggplot(sessionDF[sessionDF$session_number == i,], aes(x = trial_number, y = firing_rate)) + geom_point() + geom_smooth(formula = y ~ x, method="lm") + ggtitle("Firing Rate Against Trials") + labs(y = "Firing Rate", x = "Trials")
  
  grid.arrange(plot1, plot2, plot3, plot4, nrow = 2, ncol = 2, top = textGrob(paste("Session", i, "Scatterplots")))
   
}

```


```{r}
# Plots for variables against trials (for session analysis)

ggplot(sessionDF, aes(x = trial_number, y = number_of_active_neurons, colour = session_number)) + geom_point() + geom_smooth(method = "loess", formula = y ~ x) + ggtitle("Scatterplot of Number of Active Neurons Against Trials") + labs(y = "Number of Active Neurons", x = "Trials")

ggplot(sessionDF, aes(x = trial_number, y = total_number_of_spks, colour = session_number)) + geom_point() + geom_smooth(method = "loess", formula = y ~ x) + ggtitle("Scatterplot of Total Number of Spikes Against Trials") + labs(y = "Total Number of Spikes", x = "Trials")

ggplot(sessionDF, aes(x = trial_number, y = proportion_of_active_neurons, colour = session_number)) + geom_point() + geom_smooth(method = "loess", formula = y ~ x)  + ggtitle("Scatterplot of Proportion of Active Neurons Against Trials") + labs(y = "Proportion of Active Neurons", x = "Trials")

ggplot(sessionDF, aes(x = trial_number, y = firing_rate, colour = session_number)) + geom_point() + geom_smooth(method = "loess", formula = y ~ x)  + ggtitle("Scatterplot of Firing Rate Against Trials") + labs(y = "Firing Rate", x = "Trials")


```


```{r}
# Combine both dataframes to one large one

completeDF <- cbind(sessionDF, subset(brainarea_firing_rateDF, select = -c(session_number, trial_number) ))
#head(completeDF)
datatable(completeDF)

```


```{r}
# Scatterplot for Mice Brain areas on feedback type per mouse

for (i in 1:18) {
  
  tempBrainAreaDF <- completeDF[completeDF$session_number == i, colSums(is.na(completeDF[completeDF$session_number == i,])) == 0]
  tempBrainAreaDF <- melt(tempBrainAreaDF, id.vars = "feedback_type", measure.vars = colnames(tempBrainAreaDF)[14:length(colnames(tempBrainAreaDF))])
  
  
  tempPlot <- ggplot(tempBrainAreaDF) + geom_boxplot(aes(x = as.factor(feedback_type), y = value, color = variable), outlier.color="red", outlier.shape=8, outlier.size=2, alpha = 0.2) + xlab("Feedback Type") + ylab("Firing Rate") + ggtitle(paste("Session", i, "Box Plot of Brain Area Firing Rate on Feedback Type")) + guides(color = guide_legend(title = "Brain Areas"))
  
  print(tempPlot)
  
}

```


```{r}
# Scatterplot of mice brainarea firing rate by trial per mouse

tempBrainAreaPerMouse <- completeDF[completeDF$mouse_name == mouseNameVector[4], ]
tempBrainAreaPerMouse <- tempBrainAreaPerMouse[,colSums(is.na(tempBrainAreaPerMouse))<nrow(tempBrainAreaPerMouse)]
tempBrainAreaPerMouse <- tempBrainAreaPerMouse[, 14:length(colnames(tempBrainAreaPerMouse))]
tempBrainAreaPerMouse[is.na(tempBrainAreaPerMouse)] <- 0

ggplot(melt(tempBrainAreaPerMouse), aes(x = variable, y = value)) + geom_boxplot(outlier.color="red", outlier.shape=8, outlier.size=2, alpha = 0.2) + xlab("Brain Areas") + ylab("Firing Rate") + ggtitle(paste("Mouse", mouseNameVector[4], "Box Plots of Brain Area Firing Rates"))


```


```{r}
# Create general plot so that we can use clustering to find the specific trials that we can combine into one dataframe
# Do this for different variables (eg. proportion of active neurons, etc)
# This new dataframe will hold the values that provide information for a better predictive model

# Can do kmeans on multiple dimensions aka multiple variables, do 2-7 clusters

clusterDF <- sessionDF[, 4:14]
clusterDF <- clusterDF[, !names(clusterDF) %in% c("number_of_trials")]
clusterDF <- cbind(seq(1, nrow(clusterDF), by=1), clusterDF)
colnames(clusterDF)[1] = "id"

# Clustering data for 3 clusters
clusterDF.k3 <- clusterDF %>% kmeans(3)
clusterIndicatorVector <- clusterDF.k3$cluster

# Append the cluster indicator to the dataframes for further analysis
completeDF <- cbind(clusterIndicatorVector, completeDF)
clusterDF <- cbind(clusterIndicatorVector, clusterDF)

colnames(completeDF)[1] <- "cluster_id"
colnames(clusterDF)[1] <- "cluster_id"

```


```{r}
# Plots demonstrating clusters

clusterDF %>% mutate(cluster = clusterDF.k3$cluster) %>%
  ggplot(aes(x = number_of_active_neurons, y = firing_rate, color = as.factor(cluster))) + 
  geom_point()

clusterDF %>% mutate(cluster = clusterDF.k3$cluster) %>%
  ggplot(aes(x = number_of_unique_brain_area, y = total_number_of_spks, color = as.factor(cluster))) + 
  geom_point()

clusterDF %>% mutate(cluster = clusterDF.k3$cluster) %>%
  ggplot(aes(x = total_number_of_spks, y = firing_rate, color = as.factor(cluster))) + 
  geom_point()

# Which contrast has most effect on firing rate
#clusterDF %>% mutate(cluster = clusterDF.k3$cluster) %>%
#  ggplot(aes(x = contrast_left, y = firing_rate, color = as.factor(cluster))) + 
#  geom_point()

#clusterDF %>% mutate(cluster = clusterDF.k3$cluster) %>%
#  ggplot(aes(x = contrast_right, y = firing_rate, color = as.factor(cluster))) + 
#  geom_point()


```

```{r}

# Separate the complete dataframe into 3 separate dataframes based on cluster_id

cluster1DF <- completeDF[completeDF$cluster_id == 1,]
cluster1DF <- cluster1DF[,colSums(is.na(cluster1DF))<nrow(cluster1DF)]
cluster1DF[is.na(cluster1DF)] <- 0

cluster2DF <- completeDF[completeDF$cluster_id == 2,]
cluster2DF <- cluster2DF[,colSums(is.na(cluster2DF))<nrow(cluster2DF)]
cluster2DF[is.na(cluster2DF)] <- 0

cluster3DF <- completeDF[completeDF$cluster_id == 3,]
cluster3DF <- cluster3DF[,colSums(is.na(cluster3DF))<nrow(cluster3DF)]
cluster3DF[is.na(cluster3DF)] <- 0

# Correlation matrices for new dataframe clusters

ggcorrplot(round(cor(cluster1DF[, 5:15]), 1), hc.order = TRUE,
    type = "lower", lab =TRUE, p.mat = cor_pmat(cluster1DF[, 5:15]))

ggcorrplot(round(cor(cluster2DF[, 5:15]), 1), hc.order = TRUE,
    type = "lower", lab =TRUE, p.mat = cor_pmat(cluster2DF[, 5:15]))

ggcorrplot(round(cor(cluster3DF[, 5:15]), 1), hc.order = TRUE,
    type = "lower", lab =TRUE, p.mat = cor_pmat(cluster3DF[, 5:15]))

```


```{r}

# Figure out which variables and their weighting from the specific clusterDF to use for predictive model using PCA

cluster1DF.pca <- cluster1DF[, 5:ncol(cluster1DF)] %>% prcomp(center = TRUE, scale = TRUE)
cluster2DF.pca <- cluster2DF[, 5:ncol(cluster2DF)] %>% prcomp(center = TRUE, scale = TRUE)
cluster3DF.pca <- cluster3DF[, 5:ncol(cluster3DF)] %>% prcomp(center = TRUE, scale = TRUE)

cluster1DF.pca$rotation
summary(cluster1DF.pca)

par(mfrow=c(1,3))
plot(cluster1DF.pca, type = 'l', main = "Cluster 1 Scree Plot")
plot(cluster2DF.pca, type = 'l', main = "Cluster 2 Scree Plot")
plot(cluster3DF.pca, type = 'l', main = "Cluster 3 Scree Plot")

par(mfrow=c(1,3))
biplot(cluster1DF.pca)
biplot(cluster2DF.pca)
biplot(cluster3DF.pca)


```

```{r}
#TODO: Ask if I should include the analysis on brain area (brain_areaDF, etc.) since I do not use the variables 

# Ask how I can determine which cluster to use
# Ask how I should pick the specific variables to use for regression (should I use the correlation matrix, or pca to make decision)

# Ask if it is okay to drop brain area variables that have all zero/NA columns in the specific clusterDF. (The variable may be used in other clusterDFs)


```


```{r}

# USe logisitic regression with the variables chosen above to form a prediction model

#Cluster1.logReg <- glm(Species ~ Sepal.Length + Sepal.Width, data = cluster1DF, family = "binomial")

```


# Extra

```{r}

dat <- session[[1]]

#session[[1]]$brain_area

unique(dat$brain_area)

i_trial = 12;
i_session = 1;

dim(session[[i_session]]$spks[[i_trial]])

length(session[[i_session]]$feedback_type)

apply(session[[i_session]]$spks[[i_trial]], 2, sum)

names(session[[2]])

#Use different spks trials to make predictive models (logistic regression will work, show some linear or svm)
#session[[i_session]]$spks[[i_trial]]
#to predict:
#session[[i_session]]$feedback_type[i_trial]

# LOOK AT COURSE PROJECT DESCRIPTION .RMD FOR VARIABLE EXPLORATION

#Ask if we are using the trials of spks in combination with other recorded variables (eg. brain_area, contrast_left, contrast_right) to predict the feedback_type. Yes

#Predict the feedback_type per trial, not session

# Create df including all sessions, each session df will have rows as trials, and the columns will be variables of each trial (contrast_left, contrast_right, firing_rate, feedback_type). Use bind to stack each session df.

```



